# refactor-plan

ë¦¬íŒ©í† ë§ ê³„íšì„œ ìƒì„± ìë™í™” ìŠ¤í‚¬ (`/refactor-plan [scope]`)

## ëª©í‘œ
- ì²´ê³„ì ì¸ ë¦¬íŒ©í† ë§ ê³„íš ìˆ˜ë¦½
- ìš°ì„ ìˆœìœ„ ê¸°ë°˜ ì‘ì—… ì •ë ¬ (P0 â†’ P3)
- ì ì§„ì  ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ëµ ì œê³µ
- ê²€ì¦ ë° ë¡¤ë°± ê³„íš í¬í•¨

## íŠ¸ë¦¬ê±° ì¡°ê±´
ë‹¤ìŒ ìƒí™©ì—ì„œ ì´ ìŠ¤í‚¬ì„ ì‹¤í–‰í•©ë‹ˆë‹¤:
- "/refactor-plan [scope]" ëª…ë ¹ì–´
- "ë¦¬íŒ©í† ë§ ê³„íš ì„¸ì›Œì¤˜" ìš”ì²­
- `/arch-check` ë˜ëŠ” `/provider-centralize` í›„ ìœ„ë°˜ ë°œê²¬ ì‹œ

## Scope ì˜µì…˜
| Scope | ì„¤ëª… | ì˜ˆì‹œ |
|-------|------|------|
| `arch` | ì•„í‚¤í…ì²˜ ìœ„ë°˜ ìˆ˜ì • | `/refactor-plan arch` |
| `providers` | Provider ì •ë¦¬ | `/refactor-plan providers` |
| `widgets` | ëŒ€í˜• ìœ„ì ¯ ë¶„í•´ | `/refactor-plan widgets` |
| `all` | ì „ì²´ ì½”ë“œë² ì´ìŠ¤ | `/refactor-plan all` |
| `[file]` | íŠ¹ì • íŒŒì¼ | `/refactor-plan settings_screen.dart` |

## í”„ë¡œì„¸ìŠ¤

### Step 1: í˜„í™© ë¶„ì„
```bash
# ì½”ë“œë² ì´ìŠ¤ ê·œëª¨
find lib -name "*.dart" | wc -l

# í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€
flutter test --coverage
lcov --summary coverage/lcov.info

# ë¦°íŠ¸ ìƒíƒœ
flutter analyze 2>&1 | tail -5
```

### Step 2: ì´ìŠˆ ìˆ˜ì§‘ ë° ë¶„ë¥˜
ë¶„ì„ ë„êµ¬ ì‹¤í–‰:
```
/arch-check           â†’ ì•„í‚¤í…ì²˜ ìœ„ë°˜
/provider-centralize  â†’ Provider ì´ìŠˆ
/widget-decompose     â†’ ëŒ€í˜• ìœ„ì ¯ (dry-run)
```

### Step 3: ìš°ì„ ìˆœìœ„ ë§¤íŠ¸ë¦­ìŠ¤ ì‘ì„±
| ìš°ì„ ìˆœìœ„ | ê¸°ì¤€ | ì˜ˆì‹œ |
|----------|------|------|
| **P0** | ì•„í‚¤í…ì²˜ ì›ì¹™ ìœ„ë°˜ | domain â†’ data ì˜ì¡´ |
| **P1** | ìœ ì§€ë³´ìˆ˜ì„± ì €í•˜ | Provider ì¤‘ë³µ, ë¶„ì‚° |
| **P2** | ì½”ë“œ í’ˆì§ˆ | ëŒ€í˜• ìœ„ì ¯, ë³µì¡ë„ |
| **P3** | ê°œì„  ê¶Œì¥ | ë„¤ì´ë°, ì£¼ì„ ì •ë¦¬ |

### Step 4: ê³„íšì„œ í…œí”Œë¦¿ ìƒì„±
```markdown
# ë¦¬íŒ©í† ë§ ê³„íšì„œ

> ì‘ì„±ì¼: YYYY-MM-DD

## 1. í˜„í™© ë¶„ì„ ìš”ì•½
| í•­ëª© | ê°’ | í‰ê°€ |
|------|-----|------|
| ì´ Dart íŒŒì¼ | Nê°œ | - |
| í…ŒìŠ¤íŠ¸ íŒŒì¼ | Nê°œ | - |
| P0 ì´ìŠˆ | Nê°œ | ë†’ìŒ/ë‚®ìŒ |
| P1 ì´ìŠˆ | Nê°œ | ë†’ìŒ/ë‚®ìŒ |

## 2. ë°œê²¬ëœ ì´ìŠˆ
| ìš°ì„ ìˆœìœ„ | ì´ìŠˆ | íŒŒì¼ | ì˜í–¥ë„ |
|----------|------|------|--------|
| P0 | ... | ... | ë†’ìŒ |

## 3. ë‹¨ê³„ë³„ ì‹¤í–‰ ê³„íš
### Phase 1: P0 ìˆ˜ì •
### Phase 2: P1 ìˆ˜ì •
### Phase 3: P2 ìˆ˜ì •
### Phase 4: P3 ìˆ˜ì •

## 4. ê²€ì¦ ë°©ë²•
## 5. ì œì•½ì‚¬í•­ ì¤€ìˆ˜
## 6. ì»¤ë°‹ ê³„íš
```

### Step 5: Phaseë³„ ìƒì„¸ ê³„íš
ê° Phaseì— í¬í•¨:
- **ëª©í‘œ**: í•´ê²°í•  ì´ìŠˆ
- **íŒŒì¼**: ìˆ˜ì • ëŒ€ìƒ
- **ë‹¨ê³„**: ì„¸ë¶€ ì‘ì—…
- **ê²€ì¦**: í™•ì¸ ë°©ë²•
- **ë¡¤ë°±**: ì‹¤íŒ¨ ì‹œ ë³µêµ¬ ë°©ì•ˆ

### Step 6: ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸ ìƒì„±
```bash
# Phase ì™„ë£Œ í›„ ì‹¤í–‰
flutter analyze --no-fatal-infos
flutter test
grep -rn "TODO\|FIXME" lib/

# ì•„í‚¤í…ì²˜ ê²€ì¦
grep -r "import.*data/datasources" lib/presentation/ --include="*.dart"

# ë¹Œë“œ í™•ì¸
flutter build apk --debug
```

## ì¶œë ¥ í˜•ì‹

```
=== ğŸ“‹ Refactoring Plan Generated ===

ğŸ“ ì €ì¥ ìœ„ì¹˜: .claude/plans/{plan-name}.md

ğŸ“Š ê³„íš ìš”ì•½
â”œâ”€â”€ ì´ Phase: 4ê°œ
â”œâ”€â”€ P0 Critical: 1ê°œ ì´ìŠˆ
â”œâ”€â”€ P1 High: 2ê°œ ì´ìŠˆ
â”œâ”€â”€ P2 Medium: 3ê°œ ì´ìŠˆ
â””â”€â”€ P3 Low: 0ê°œ ì´ìŠˆ

ğŸ—“ï¸ Phase ê°œìš”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ Phase 1: ì•„í‚¤í…ì²˜ ìœ„ë°˜ ìˆ˜ì • (P0)
â”‚ â”œâ”€â”€ íŒŒì¼: 3ê°œ
â”‚ â””â”€â”€ ì‘ì—…: SettingsRepository í™•ì¥, DI ìˆ˜ì •
â”‚
â”‚ Phase 2: Provider ì •ë¦¬ (P1)
â”‚ â”œâ”€â”€ íŒŒì¼: 5ê°œ
â”‚ â””â”€â”€ ì‘ì—…: ì¤‘ë³µ ì œê±°, ë°°ëŸ´ íŒŒì¼ ì™„ì„±
â”‚
â”‚ Phase 3: ìœ„ì ¯ ë¶„í•´ (P2)
â”‚ â”œâ”€â”€ íŒŒì¼: 15ê°œ ìƒì„±
â”‚ â””â”€â”€ ì‘ì—…: SettingsScreen, ResultCard ë¶„í•´
â”‚
â”‚ Phase 4: UI State í†µí•© (P3)
â”‚ â”œâ”€â”€ íŒŒì¼: 4ê°œ
â”‚ â””â”€â”€ ì‘ì—…: ui_state_providers.dart ìƒì„±
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ”– ì»¤ë°‹ ê³„íš
â”œâ”€â”€ refactor(arch): P0 architecture fix
â”œâ”€â”€ refactor(providers): P1 provider cleanup
â”œâ”€â”€ refactor(ui): P2 widget decomposition
â””â”€â”€ refactor(providers): P3 UI state centralization

ë‹¤ìŒ ë‹¨ê³„:
â””â”€â”€ ê³„íš ìŠ¹ì¸ í›„ Phase 1 ì‹œì‘: /sc:implement Phase 1
```

## ê³„íšì„œ ì €ì¥ ìœ„ì¹˜
```
.claude/plans/{descriptive-name}.md
```
ì˜ˆ: `.claude/plans/steady-purring-lobster.md`

## ì‚¬ìš© ì˜ˆì‹œ

```
> "/refactor-plan all"

AI ì‘ë‹µ:
1. ì½”ë“œë² ì´ìŠ¤ ë¶„ì„ ì‹¤í–‰
2. /arch-check: 1ê°œ P0 ìœ„ë°˜ ë°œê²¬
3. /provider-centralize: 2ê°œ ì¤‘ë³µ, 2ê°œ ë¶„ì‚° ë°œê²¬
4. /widget-decompose (ë¶„ì„): 3ê°œ ëŒ€í˜• ìœ„ì ¯ ë°œê²¬
5. 4-Phase ê³„íšì„œ ìƒì„±
6. .claude/plans/ì— ì €ì¥
7. ê³„íšì„œ ìš”ì•½ ì¶œë ¥

ê³„íš ì‹¤í–‰ ì‹œì‘:
â””â”€â”€ /sc:implement Phase 1: P0 ì•„í‚¤í…ì²˜ ìœ„ë°˜ ìˆ˜ì •
```

## ì—°ê´€ ìŠ¤í‚¬
- `/arch-check` - ì•„í‚¤í…ì²˜ ìœ„ë°˜ ë¶„ì„
- `/provider-centralize` - Provider ë¶„ì„
- `/widget-decompose` - ìœ„ì ¯ ë¶„í•´ ë¶„ì„
- `/sc:implement` - ê³„íš ì‹¤í–‰

## ì£¼ì˜ì‚¬í•­
- ì ì§„ì  ë³€ê²½: í•œ ë²ˆì— í•˜ë‚˜ì˜ Phaseë§Œ ì‹¤í–‰
- ë…ë¦½ ì»¤ë°‹: ê° PhaseëŠ” ë³„ë„ ì»¤ë°‹ ê°€ëŠ¥í•´ì•¼ í•¨
- í…ŒìŠ¤íŠ¸ í†µê³¼: Phase ì™„ë£Œ í›„ ë°˜ë“œì‹œ ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
- ë¡¤ë°± ê°€ëŠ¥: ì¤‘ê°„ ìƒíƒœì—ì„œë„ ì•±ì´ ë¹Œë“œë˜ì–´ì•¼ í•¨
- Critical ì½”ë“œ ë³´í˜¸: `SafetyBlockedFailure`, `is_emergency` ë“± ìˆ˜ì • ê¸ˆì§€

---

## Skill Metadata

| Property | Value |
|----------|-------|
| Priority | P0 |
| Category | quality |
| Dependencies | arch-check, provider-centralize, widget-decompose |
| Created | 2026-01-26 |
| Updated | 2026-01-26 |
