# systematic-debugging

체계적 디버깅 스킬 (`/debug [action]`)

## 목표
- 추측 기반 디버깅 금지, 증거 기반 분석 강제
- 4단계 근본 원인 분석 프로세스
- 3회 이상 실패 시 강제 재시작 메커니즘

## 트리거 조건
다음 상황에서 이 스킬을 실행합니다:
- `/debug [action]` 명령어
- "버그 수정", "디버깅", "원인 분석" 요청
- 동일 이슈에 대해 3회 이상 수정 시도 실패 시 **자동 활성화**

## 핵심 원칙

### 금지 사항
```
❌ "아마도 ~일 것 같습니다" → 추측 금지
❌ 여러 변경 동시 적용 → 단일 변수 변경
❌ 코드 먼저 수정 → 진단 먼저
❌ "일단 해보자" → 가설 수립 먼저
```

### 필수 사항
```
✓ 재현 조건 명확화
✓ 증거 수집 (로그, 스택트레이스, 상태)
✓ 단일 변수 변경으로 가설 검증
✓ 실패 테스트 작성 후 수정
```

## 4단계 디버깅 프로세스

### Stage 1: Root Cause Investigation (근본 원인 조사)

**목표**: 버그 재현 및 증거 수집

```
1. 재현 조건 정의
   - 입력값
   - 사전 상태
   - 환경 조건
   - 재현 성공률

2. 증거 수집
   - 에러 로그/스택트레이스
   - 관련 변수 상태
   - 시스템 상태 (메모리, DB 등)
   - 타임라인 (언제부터 발생?)

3. 데이터 흐름 추적
   - 입력 → 처리 → 출력 경로
   - 변환 지점마다 상태 확인
   - 비정상 분기 지점 특정
```

**출력 템플릿**:
```markdown
## Investigation Report

### 재현 조건
- 입력: [구체적 입력값]
- 상태: [사전 조건]
- 재현율: [100% / 간헐적]

### 수집된 증거
- 로그: [관련 로그 라인]
- 스택트레이스: [핵심 부분]
- 상태: [변수/DB 상태]

### 데이터 흐름
[입력] → [처리1] → [처리2] → ❌ [실패 지점]
```

### Stage 2: Pattern Analysis (패턴 분석)

**목표**: 정상 동작 코드와 비교하여 차이점 발견

```
1. 유사 기능 코드 탐색
   - 동일 패턴의 정상 동작 코드
   - 동일 레이어의 다른 구현체
   - 과거 커밋에서 정상 동작 버전

2. 차이점 분석
   - 코드 구조 차이
   - 에러 처리 차이
   - 타이밍/순서 차이
   - 의존성 차이

3. 가설 도출
   - 차이점 기반 가설 3-5개 수립
   - 각 가설의 검증 방법 정의
```

**출력 템플릿**:
```markdown
## Pattern Analysis

### 비교 대상
- 정상: [파일경로:라인]
- 문제: [파일경로:라인]

### 핵심 차이점
1. [차이점 1]
2. [차이점 2]
3. [차이점 3]

### 가설 목록
| # | 가설 | 신뢰도 | 검증 방법 |
|---|------|--------|----------|
| 1 | [가설1] | 높음 | [방법] |
| 2 | [가설2] | 중간 | [방법] |
| 3 | [가설3] | 낮음 | [방법] |
```

### Stage 3: Hypothesis Testing (가설 검증)

**목표**: 단일 변수 변경으로 가설 검증

```
1. 가설 우선순위 선정
   - 신뢰도 높은 가설부터
   - 검증 비용 낮은 가설 우선

2. 단일 변수 변경
   ⚠️ 한 번에 하나의 변경만 적용
   ⚠️ 변경 전 상태 기록
   ⚠️ 변경 후 결과 기록

3. 검증 결과 기록
   - 가설 확인/기각
   - 새로운 정보 발견 시 가설 업데이트
```

**단일 변수 변경 체크리스트**:
```
□ 한 번에 하나의 변경만 적용했는가?
□ 변경 전 상태를 기록했는가?
□ 변경 결과가 가설과 일치하는가?
□ 원복 가능한가?
```

**출력 템플릿**:
```markdown
## Hypothesis Test: #{가설번호}

### 가설
[가설 내용]

### 변경 내용
- 파일: [경로]
- 변경: [before] → [after]

### 결과
- 상태: ✓ 확인 / ✗ 기각 / ? 추가 조사 필요
- 관찰: [결과 상세]

### 다음 단계
[다음 가설 검증 / 수정 구현 / 추가 조사]
```

### Stage 4: Implementation (구현)

**목표**: 실패 테스트 작성 → 수정 → 검증

```
1. 실패 테스트 작성 (RED)
   - 버그를 재현하는 테스트
   - 현재 상태에서 반드시 실패해야 함
   - 테스트 실행하여 실패 확인

2. 수정 구현 (GREEN)
   - 테스트 통과하는 최소 수정
   - 검증된 가설 기반 수정만 적용

3. 리팩토링 (REFACTOR)
   - 중복 제거
   - 가독성 개선
   - 테스트 재실행

4. 회귀 테스트
   - 기존 테스트 전체 실행
   - 다른 기능 영향 확인
```

**구현 체크리스트**:
```
□ 실패 테스트 작성 완료
□ 테스트 실패 확인 (RED 상태)
□ 수정 후 테스트 통과 (GREEN 상태)
□ 기존 테스트 전체 통과
□ lint 경고 없음
```

## 3회 실패 시 강제 재시작

동일 이슈에 대해 3회 이상 수정 시도가 실패하면:

```
⚠️ DEBUGGING RESTART REQUIRED

실패 횟수: 3회 이상
조치: Stage 1부터 재시작 필요

이전 시도 분석:
- 시도 1: [내용] → [실패 이유]
- 시도 2: [내용] → [실패 이유]
- 시도 3: [내용] → [실패 이유]

권장 사항:
1. 기존 가설 전체 폐기
2. 새로운 증거 수집
3. 다른 관점에서 재분석
```

## 출력 형식

### 디버깅 시작
```
═══════════════════════════════════════════════════════════
                 Systematic Debugging Started
═══════════════════════════════════════════════════════════

이슈: [이슈 설명]
현재 단계: Stage 1 - Root Cause Investigation

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### 디버깅 완료
```
═══════════════════════════════════════════════════════════
                 Debugging Complete
═══════════════════════════════════════════════════════════

이슈: [이슈 설명]
근본 원인: [원인]
해결 방법: [수정 내용]

검증:
├── 실패 테스트 → 통과 ✓
├── 기존 테스트 전체 통과 ✓
└── lint 경고 없음 ✓

수정된 파일:
├── [파일1]
└── [파일2]

═══════════════════════════════════════════════════════════
```

## 사용 예시

### 기본 사용
```
> "/debug analyze"

AI 응답:
1. Stage 1: 증거 수집 시작
2. 재현 조건 정의
3. 데이터 흐름 추적
4. Investigation Report 출력
```

### 특정 에러 디버깅
```
> "/debug NullPointerException in diary_screen.dart:123"

AI 응답:
1. 스택트레이스 분석
2. null이 될 수 있는 변수 추적
3. 가설 수립 및 검증
4. 실패 테스트 작성 → 수정
```

### 간헐적 버그 디버깅
```
> "/debug intermittent crash on home screen"

AI 응답:
1. 재현 조건 탐색 (race condition 의심)
2. 타이밍 관련 증거 수집
3. 비동기 처리 흐름 분석
4. 가설 검증 및 수정
```

## 자동 감지 키워드

다음 키워드가 대화에서 감지되면 경고 표시:

```
⚠️ 추측 감지: "아마", "~일 것 같다", "일단 해보자"
→ 증거 기반 분석으로 전환하세요.

⚠️ 다중 변경 감지: 2개 이상 파일 동시 수정 시도
→ 단일 변수 변경 원칙을 지키세요.
```

## 연관 스킬
- `/test-unit-gen` - 실패 테스트 생성
- `/swarm-review` - 수정 후 품질 검증
- `/lint-fix` - 린트 경고 해결

## 주의사항
- 추측 기반 수정 시 경고 후 Stage 1로 회귀
- 3회 이상 실패 시 강제 재시작 메커니즘 발동
- 실패 테스트 없이 수정하면 Stage 4 불완전 경고
- MindLog 특수 규칙: `SafetyBlockedFailure`, `is_emergency` 관련 버그는 추가 보안 검토 필수

---

## Skill Metadata

| Property | Value |
|----------|-------|
| Priority | P1 |
| Category | debugging |
| Dependencies | - |
| Created | 2026-02-05 |
| Updated | 2026-02-05 |
