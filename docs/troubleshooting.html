<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê°€ì´ë“œ - MindLog</title>
    <meta name="description" content="MindLog ì•Œë ¤ì§„ ì´ìŠˆì™€ í•´ê²° ë°©ë²•ì„ í™•ì¸í•˜ì„¸ìš”.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Batang:wght@400;700&family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css?v=20260110-ux">
</head>
<body>
    <a href="#issues-grid" class="skip-link">ì´ìŠˆ ëª©ë¡ìœ¼ë¡œ ê±´ë„ˆë›°ê¸°</a>
    <header class="hero troubleshooting-hero" id="top">
        <nav class="nav container">
            <a href="index.html" class="nav-brand">MindLog</a>
            <div class="nav-links">
                <a href="index.html">í™ˆ</a>
                <a href="index.html#features">ê¸°ëŠ¥</a>
                <a href="index.html#updates">ìµœê·¼ ê°œì„ </a>
                <a href="troubleshooting.html" class="active">íŠ¸ëŸ¬ë¸”ìŠˆíŒ…</a>
                <a href="https://github.com/kaywalker91/MindLog" target="_blank" rel="noopener">GitHub</a>
            </div>
        </nav>
        <div class="hero-content container troubleshooting-hero-content">
            <span class="hero-pill">ê°œë°œì ê°€ì´ë“œ</span>
            <h1>íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê°€ì´ë“œ</h1>
            <p class="hero-subtitle">ì•Œë ¤ì§„ ì´ìŠˆì™€ í•´ê²° ë°©ë²•</p>
        </div>
    </header>

    <section class="troubleshooting-filters">
        <div class="container filters-container">
            <div class="filter-group">
                <span class="filter-label">ìƒíƒœ:</span>
                <button class="filter-btn active" data-status="all">ì „ì²´</button>
                <button class="filter-btn" data-status="resolved">í•´ê²°ë¨</button>
                <button class="filter-btn" data-status="open">ë¯¸í•´ê²°</button>
            </div>
            <div class="filter-group" id="category-filters">
                <span class="filter-label">ì¹´í…Œê³ ë¦¬:</span>
                <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
            </div>
            <div class="search-group">
                <input type="text" id="search-input" class="search-input" placeholder="ì´ìŠˆ ê²€ìƒ‰...">
            </div>
        </div>
    </section>

    <section class="troubleshooting-list">
        <div class="container">
            <p id="results-count" class="results-count" aria-live="polite"></p>
            <div id="issues-grid" class="issues-grid">
                <!-- JavaScriptë¡œ ë™ì  ë Œë”ë§ -->
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <p>ì´ìŠˆ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                </div>
            </div>
        </div>
    </section>

    <section class="cta">
        <div class="container">
            <h2>ì´ìŠˆë¥¼ ë°œê²¬í•˜ì…¨ë‚˜ìš”?</h2>
            <p>GitHubì—ì„œ ìƒˆë¡œìš´ ì´ìŠˆë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”.</p>
            <div class="hero-buttons">
                <a href="https://github.com/kaywalker91/MindLog/issues/new" class="btn btn-primary" target="_blank" rel="noopener">
                    ì´ìŠˆ ë“±ë¡í•˜ê¸°
                </a>
                <a href="index.html" class="btn btn-secondary">í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
            </div>
        </div>
    </section>

    <!-- Issue Detail Modal -->
    <div id="issue-modal" class="modal" aria-hidden="true">
        <div class="modal-overlay" data-close-modal></div>
        <div class="modal-container">
            <header class="modal-header">
                <h2 id="modal-title">ì´ìŠˆ ìƒì„¸</h2>
                <button class="modal-close" data-close-modal aria-label="ë‹«ê¸°">&times;</button>
            </header>
            <div id="modal-content" class="modal-content">
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <p>ë¬¸ì„œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 MindLog. Made with Flutter.</p>
            <p>
                <a href="https://github.com/kaywalker91/MindLog" target="_blank" rel="noopener">GitHub</a>
            </p>
        </div>
    </footer>

    <!-- Marked.js for Markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <script>
    (function() {
        'use strict';

        let allIssues = [];
        let categories = {};
        let currentFilters = {
            status: 'all',
            category: 'all',
            search: ''
        };

        // DOM Elements
        const issuesGrid = document.getElementById('issues-grid');
        const searchInput = document.getElementById('search-input');
        const categoryFilters = document.getElementById('category-filters');
        const resultsCount = document.getElementById('results-count');

        // Initialize
        async function init() {
            try {
                const data = await fetch('troubleshooting.json').then(r => r.json());
                allIssues = data.issues || [];
                categories = data.categories || {};

                renderCategoryFilters();
                setupEventListeners();
                renderIssues();
            } catch (error) {
                console.error('Failed to load issues:', error);
                showError();
            }
        }

        // Render category filter buttons
        function renderCategoryFilters() {
            if (!categoryFilters) return;

            let html = '<span class="filter-label">ì¹´í…Œê³ ë¦¬:</span>';
            html += '<button class="filter-btn active" data-category="all">ì „ì²´</button>';

            for (const [key, label] of Object.entries(categories)) {
                html += `<button class="filter-btn" data-category="${key}">${label}</button>`;
            }

            categoryFilters.innerHTML = html;
        }

        // Setup event listeners
        function setupEventListeners() {
            // Status filters
            document.querySelectorAll('[data-status]').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('[data-status]').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentFilters.status = btn.dataset.status;
                    renderIssues();
                });
            });

            // Category filters
            categoryFilters?.addEventListener('click', (e) => {
                if (e.target.matches('[data-category]')) {
                    categoryFilters.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    currentFilters.category = e.target.dataset.category;
                    renderIssues();
                }
            });

            // Search
            searchInput?.addEventListener('input', debounce((e) => {
                currentFilters.search = e.target.value.toLowerCase().trim();
                renderIssues();
            }, 300));
        }

        // Filter issues
        function filterIssues() {
            return allIssues.filter(issue => {
                // Status filter
                if (currentFilters.status !== 'all') {
                    if (currentFilters.status === 'resolved' && issue.status !== 'resolved') return false;
                    if (currentFilters.status === 'open' && issue.status === 'resolved') return false;
                }

                // Category filter
                if (currentFilters.category !== 'all' && issue.category !== currentFilters.category) {
                    return false;
                }

                // Search filter
                if (currentFilters.search) {
                    const searchTarget = [
                        issue.title,
                        issue.summary,
                        issue.cause,
                        issue.solution,
                        ...(issue.tags || [])
                    ].join(' ').toLowerCase();

                    if (!searchTarget.includes(currentFilters.search)) return false;
                }

                return true;
            });
        }

        // Render issues
        function renderIssues() {
            const filtered = filterIssues();

            // Update results count
            resultsCount.textContent = `${filtered.length}ê°œì˜ ì´ìŠˆê°€ ìˆìŠµë‹ˆë‹¤`;

            if (filtered.length === 0) {
                issuesGrid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ”</div>
                        <h3>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p>ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë‚˜ í•„í„°ë¥¼ ì‹œë„í•´ë³´ì„¸ìš”.</p>
                        <div class="empty-state-actions">
                            <button class="btn-reset" onclick="resetFilters()">í•„í„° ì´ˆê¸°í™”</button>
                        </div>
                    </div>
                `;
                return;
            }

            issuesGrid.innerHTML = filtered.map(issue => renderIssueCard(issue)).join('');
        }

        // Reset filters function
        window.resetFilters = function() {
            // Reset status filters
            document.querySelectorAll('[data-status]').forEach(b => b.classList.remove('active'));
            document.querySelector('[data-status="all"]')?.classList.add('active');
            currentFilters.status = 'all';

            // Reset category filters
            categoryFilters?.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            categoryFilters?.querySelector('[data-category="all"]')?.classList.add('active');
            currentFilters.category = 'all';

            // Reset search
            if (searchInput) searchInput.value = '';
            currentFilters.search = '';

            renderIssues();
        };

        // Severity labels for display
        const severityLabels = { critical: 'Critical', major: 'Major', minor: 'Minor' };

        // Render single issue card with hierarchical structure
        function renderIssueCard(issue) {
            const statusClass = issue.status === 'resolved' ? 'resolved' : 'open';
            const statusText = issue.status === 'resolved' ? 'í•´ê²°ë¨' : 'ë¯¸í•´ê²°';
            const severityClass = (issue.severity || 'minor').toLowerCase();
            const categoryLabel = categories[issue.category] || issue.category;
            const dateText = issue.status === 'resolved' ? issue.resolvedAt : '';
            const versionsText = issue.affectedVersions?.join(', ') || '';

            return `
                <article class="issue-card" data-id="${issue.id}" data-category="${issue.category}">
                    <div class="issue-card__primary">
                        <div class="issue-header">
                            <span class="issue-status ${statusClass}">${statusText}</span>
                            <span class="issue-severity ${severityClass}">${severityLabels[severityClass] || 'Minor'}</span>
                            ${dateText ? `<span class="issue-date">${dateText}</span>` : ''}
                        </div>
                        <h3 class="issue-title">${escapeHtml(issue.title)}</h3>
                    </div>
                    <div class="issue-card__secondary">
                        <p class="issue-summary">${escapeHtml(issue.summary)}</p>
                    </div>
                    <div class="issue-card__tertiary">
                        <div class="issue-meta">
                            <span class="issue-category">${categoryLabel}</span>
                            ${versionsText ? `<span class="issue-versions">ì˜í–¥: ${versionsText}</span>` : ''}
                        </div>
                        <div class="issue-tags">
                            ${(issue.tags || []).map(tag => `<span class="issue-tag">${escapeHtml(tag)}</span>`).join('')}
                        </div>
                    </div>
                    ${issue.documentation ? `<button class="issue-link" onclick="openIssueModal('${issue.id}')">ìƒì„¸ ë³´ê¸° â†’</button>` : ''}
                </article>
            `;
        }

        // Utilities
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function debounce(fn, delay) {
            let timer;
            return (...args) => {
                clearTimeout(timer);
                timer = setTimeout(() => fn(...args), delay);
            };
        }

        function showError() {
            issuesGrid.innerHTML = `
                <div class="empty-state">
                    <div class="empty-icon">âš ï¸</div>
                    <h3>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h3>
                    <p>ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>
                </div>
            `;
        }

        // ====== Modal Functions ======
        const modal = document.getElementById('issue-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalContent = document.getElementById('modal-content');

        // Global function for onclick
        window.openIssueModal = async function(issueId) {
            const issue = allIssues.find(i => i.id === issueId);
            if (!issue) return;

            // Show modal with loading state
            modalTitle.textContent = issue.title;
            modalContent.innerHTML = `
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <p>ë¬¸ì„œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                </div>
            `;
            modal.classList.add('is-open');
            modal.setAttribute('aria-hidden', 'false');
            document.body.style.overflow = 'hidden';

            // Fetch and render markdown
            if (issue.documentation) {
                try {
                    const response = await fetch(issue.documentation);
                    if (!response.ok) throw new Error('Failed to fetch');
                    const markdown = await response.text();

                    // Render markdown to HTML using marked.js
                    const html = marked.parse(markdown);
                    modalContent.innerHTML = `<div class="markdown-body">${html}</div>`;
                } catch (error) {
                    console.error('Failed to load documentation:', error);
                    modalContent.innerHTML = `
                        <div class="modal-error">
                            <p>ë¬¸ì„œë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                            <a href="${issue.documentation}" target="_blank" class="btn btn-secondary">
                                ë§ˆí¬ë‹¤ìš´ íŒŒì¼ ì§ì ‘ ë³´ê¸° â†’
                            </a>
                        </div>
                    `;
                }
            } else {
                // No documentation, show issue details from JSON
                modalContent.innerHTML = `
                    <div class="issue-detail">
                        <div class="issue-detail-section">
                            <h3>ìš”ì•½</h3>
                            <p>${escapeHtml(issue.summary)}</p>
                        </div>
                        ${issue.cause ? `
                        <div class="issue-detail-section">
                            <h3>ì›ì¸</h3>
                            <p>${escapeHtml(issue.cause)}</p>
                        </div>
                        ` : ''}
                        ${issue.solution ? `
                        <div class="issue-detail-section">
                            <h3>í•´ê²° ë°©ë²•</h3>
                            <p>${escapeHtml(issue.solution)}</p>
                        </div>
                        ` : ''}
                    </div>
                `;
            }
        };

        function closeModal() {
            modal.classList.remove('is-open');
            modal.setAttribute('aria-hidden', 'true');
            document.body.style.overflow = '';
        }

        // Modal event listeners
        modal?.querySelectorAll('[data-close-modal]').forEach(el => {
            el.addEventListener('click', closeModal);
        });

        // Close on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && modal.classList.contains('is-open')) {
                closeModal();
            }
        });

        // Start
        document.addEventListener('DOMContentLoaded', init);
    })();
    </script>
</body>
</html>
